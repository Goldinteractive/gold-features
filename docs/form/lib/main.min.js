!function(e,s){"object"==typeof exports&&"object"==typeof module?module.exports=s(require("js-base")):"function"==typeof define&&define.amd?define("feature-form",["js-base"],s):"object"==typeof exports?exports["feature-form"]=s(require("js-base")):e["feature-form"]=s(e["js-base"])}("undefined"!=typeof self?self:this,function(e){return function(e){var s={};function t(r){if(s[r])return s[r].exports;var o=s[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=s,t.d=function(e,s,r){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p="",t(t.s=0)}([function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=function(){function e(e,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(s,t,r){return t&&e(s.prototype,t),r&&e(s,r),s}}(),o=t(1);var n=function(e){function s(){return function(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,s){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||"object"!=typeof s&&"function"!=typeof s?e:s}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function, not "+typeof s);e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s)}(s,o.features.Feature),r(s,[{key:"init",value:function(){this.isLoading=!1,this.$form=this.$("form"),this.$feedback=this.$("[data-feedback]"),this.$progress=this.$("[data-progress]"),this.$form.noValidate=!0,this.addEventListener(this.$form,"submit",this._submitListener()),this.addEventListener(this.$form,"reset",this._resetListener())}},{key:"fetch",value:function(e,s){var t=this;return new Promise(function(r,o){var n=new XMLHttpRequest;for(var i in t.currentRequest=n,t.triggerHub("form:beforeSend",s,n),t.trigger("beforeSend",s,n),n.withCredentials=!0,n.open(s.method||"post",e),s.headers||{})s.headers.hasOwnProperty(i)&&n.setRequestHeader(i,s.headers[i]);n.onload=r,n.onerror=o,n.onabort=o,n.ontimeout=o,t.$progress&&n.upload&&(n.upload.onprogress=t._onProgress()),n.send(s.body)}).then(function(e){t.currentRequest=null;var s=e.target;if(s.status>=200&&s.status<300)return e;var r=new Error(s.statusText);throw r.response=e,r}).then(function(e){var s=e.target;return{json:JSON.parse(s.responseText),request:s}})}},{key:"showFeedback",value:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(this.$feedback.innerHTML=e,s){case 1:this.$feedback.classList.add(this.options.feedbackClassWarning);break;case 2:this.$feedback.classList.add(this.options.feedbackClassError);break;case 0:default:this.$feedback.classList.add(this.options.feedbackClassSuccess)}}},{key:"resetFeedback",value:function(){this.$feedback.innerHTML="",this.$feedback.classList.remove(this.options.feedbackClassWarning),this.$feedback.classList.remove(this.options.feedbackClassError),this.$feedback.classList.remove(this.options.feedbackClassSuccess)}},{key:"resetValidation",value:function(){var e=this;this.$$("."+this.options.formFieldClass).forEach(function(s){var t=s.querySelector(e.options.formFieldMessageElement+"."+e.options.formFieldMessageClass);s.classList.remove(e.options.formFieldClassError),t&&t.parentNode.removeChild(t)})}},{key:"resetProgress",value:function(){this.$progress&&(this.$progress.classList.remove(this.options.progressClassShow),this.setProgress(0))}},{key:"setProgress",value:function(e){if(this.$progress&&this.options.showProgress){0===e||1===e&&this.options.hideProgressOnEnd?this.$progress.classList.remove(this.options.progressClassShow):this.$progress.classList.add(this.options.progressClassShow),e*=100;var s=Math.ceil(e),t=this.$progress.querySelector("[data-loaded]"),r=this.$progress.querySelector("[data-percentage]");t.style.width=s+"%",r.textContent=s+"%"}}},{key:"displayFieldErrors",value:function(e){for(var s in e)if(e.hasOwnProperty(s)){var t=this.options.getFieldErrors.call(this,s,e),r=this.options.getErrorField.call(this,s);if(r){r.classList.add(this.options.formFieldClassError);var o=r.querySelector(this.options.formFieldMessageElement+"."+this.options.formFieldMessageClass);o||((o=document.createElement(this.options.formFieldMessageElement)).classList.add(this.options.formFieldMessageClass),r.appendChild(o)),o.innerHTML="";var n=document.createElement("span");n.textContent=t[0],o.appendChild(n)}}}},{key:"_createFormData",value:function(){return new FormData(this.$form)}},{key:"_onProgress",value:function(){var e=this;return function(s){s.lengthComputable&&e.setProgress(s.loaded/s.total)}}},{key:"_resetListener",value:function(){var e=this;return function(){e.currentRequest&&e.currentRequest.abort(),e.resetProgress(),e.resetFeedback(),e.resetValidation()}}},{key:"_submitListener",value:function(){var e=this;return function(s){if(s.preventDefault(),!e.isLoading){e.isLoading=!0;var t=e._createFormData(),r=e.$form.getAttribute("action"),o=e.$form.getAttribute("method");e.resetProgress(),e.resetFeedback(),e.resetValidation(),e.node.classList.add(e.options.classLoading),e.fetch(r,{body:t,method:o}).then(function(s){if(e.triggerHub("form:send",s),e.trigger("send",s),e.isLoading=!1,e.node.classList.remove(e.options.classLoading),s.json.success)e.triggerHub("form:sendSuccess",s),e.trigger("sendSuccess",s),e.showFeedback(s.json.message||e.options.defaultSuccessMessage),e.options.removeFormOnSuccess&&(e.$form.parentNode.removeChild(e.$form),e.options.scroller&&window.setTimeout(function(){e.options.scroller.toElement(e.$feedback||e.node)},0));else{e.triggerHub("form:sendError",s),e.trigger("sendError",s);var t=e.options.findFieldErrors(s.json);t?(e.displayFieldErrors(t),s.json.message&&e.showFeedback(s.json.message,2)):e.showFeedback(s.json.message||e.options.defaultErrorMessage,2)}}).catch(function(s){if(e.isLoading=!1,e.node.classList.remove(e.options.classLoading),s.type&&"abort"!==s.type)throw e.showFeedback(e.options.defaultErrorMessage,0),s})}}}}]),s}();n.defaultOptions={scroller:null,defaultSuccessMessage:"Nachricht wurde erfolgreich versendet!",defaultErrorMessage:"Beim Senden der Nachricht ist ein Fehler aufgetreten!",classLoading:"-loading",removeFormOnSuccess:!0,showProgress:!0,hideProgressOnEnd:!0,progressClassShow:"-show",formFieldClass:"form-field",formFieldClassError:"-error",formFieldMessageElement:"div",formFieldMessageClass:"message",feedbackClassSuccess:"-success",feedbackClassWarning:"-warning",feedbackClassError:"-error",findFieldErrors:function(e){return e.errors},getErrorField:function(e){var s=this.$form.querySelector('[name="fields['+e+']"]');return s?s.closest("."+this.options.formFieldClass):null},getFieldErrors:function(e,s){return s[e]}},s.default=n},function(s,t){s.exports=e}])});
//# sourceMappingURL=main.min.js.map