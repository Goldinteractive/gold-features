!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-base")):"function"==typeof define&&define.amd?define("feature-form",["js-base"],t):"object"==typeof exports?exports["feature-form"]=t(require("js-base")):e["feature-form"]=t(e["js-base"])}(window,function(e){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(t,s){t.exports=e},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),o=s(0);var n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.features.Feature),r(t,[{key:"init",value:function(){this.isLoading=!1,this.$form=this.$("form"),this.$feedback=this.$("[data-feedback]"),this.$progress=this.$("[data-progress]"),this.token=null,this.$form.noValidate=!0,this.addEventListener(this.$form,"submit",this._submitListener()),this.addEventListener(this.$form,"reset",this._resetListener()),this.obtainToken()}},{key:"obtainToken",value:function(){var e=this.node.dataset.tokenEndpoint||this.options.tokenEndpoint;null!==e&&this.loadToken(e).then(this.getTokenJsonHandler())}},{key:"getTokenJsonHandler",value:function(){var e=this;return function(t){e.setToken(t.data.token)}}},{key:"loadToken",value:function(e){return fetch(e,{mode:"cors"}).then(function(e){return e.json()})}},{key:"setToken",value:function(e){this.token=e,this.$form.appendChild(this.buildHiddenInput(this.options.tokenFieldName,e))}},{key:"buildHiddenInput",value:function(e,t){var s=document.createElement("input");return s.setAttribute("type","hidden"),s.setAttribute("name",e),s.setAttribute("value",t),s}},{key:"fetch",value:function(e,t){var s=this;return new Promise(function(r,o){var n=new XMLHttpRequest;for(var i in s.currentRequest=n,s.triggerHub("form:beforeSend",t,n),s.trigger("beforeSend",t,n),n.withCredentials=!1,n.open(t.method||"post",e),t.headers||{})t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);n.onload=r,n.onerror=r,n.onabort=o,n.ontimeout=o,s.$progress&&n.upload&&(n.upload.onprogress=s._onProgress()),n.send(t.body)}).then(function(e){var t=e.target;try{return{json:JSON.parse(t.responseText),request:t}}catch(e){throw e}})}},{key:"showFeedback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(this.$feedback.innerHTML=e,t){case 1:this.$feedback.classList.add(this.options.feedbackClassWarning);break;case 2:this.$feedback.classList.add(this.options.feedbackClassError);break;case 0:default:this.$feedback.classList.add(this.options.feedbackClassSuccess)}}},{key:"resetFeedback",value:function(){this.$feedback.innerHTML="",this.$feedback.classList.remove(this.options.feedbackClassWarning),this.$feedback.classList.remove(this.options.feedbackClassError),this.$feedback.classList.remove(this.options.feedbackClassSuccess)}},{key:"resetValidation",value:function(){var e=this;this.$$("."+this.options.formFieldClass).forEach(function(t){var s=t.querySelector(e.options.formFieldMessageElement+"."+e.options.formFieldMessageClass);t.classList.remove(e.options.formFieldClassError),s&&s.parentNode.removeChild(s)})}},{key:"resetProgress",value:function(){this.$progress&&(this.$progress.classList.remove(this.options.progressClassShow),this.setProgress(0))}},{key:"setProgress",value:function(e){if(this.$progress&&this.options.showProgress){0===e||1===e&&this.options.hideProgressOnEnd?this.$progress.classList.remove(this.options.progressClassShow):this.$progress.classList.add(this.options.progressClassShow),e*=100;var t=Math.ceil(e),s=this.$progress.querySelector("[data-loaded]"),r=this.$progress.querySelector("[data-percentage]");s.style.width=t+"%",r.textContent=t+"%"}}},{key:"displayFieldErrors",value:function(e){var t=this;e.forEach(function(e){var s=t.options.getFieldErrors.call(t,e),r=t.options.getErrorField.call(t,e);if(r){r.classList.add(t.options.formFieldClassError);var o=r.querySelector(t.options.formFieldMessageElement+"."+t.options.formFieldMessageClass);o||((o=document.createElement(t.options.formFieldMessageElement)).classList.add(t.options.formFieldMessageClass),r.appendChild(o)),o.innerHTML="";var n=document.createElement("span");n.textContent=s[0],o.appendChild(n)}})}},{key:"_createFormData",value:function(){return new FormData(this.$form)}},{key:"_onProgress",value:function(){var e=this;return function(t){t.lengthComputable&&e.setProgress(t.loaded/t.total)}}},{key:"_resetListener",value:function(){var e=this;return function(){e.currentRequest&&e.currentRequest.abort(),e.resetProgress(),e.resetFeedback(),e.resetValidation()}}},{key:"_submitListener",value:function(){var e=this;return function(t){if(t.preventDefault(),!e.isLoading){e.isLoading=!0;var s=e._createFormData(),r=e.$form.getAttribute("action"),o=e.$form.getAttribute("method");e.resetProgress(),e.resetFeedback(),e.resetValidation(),e.node.classList.add(e.options.classLoading),e.fetch(r,{body:s,method:o}).then(function(t){if(e.triggerHub("form:send",t),e.trigger("send",t),e.isLoading=!1,e.node.classList.remove(e.options.classLoading),t.json.status>=200&&t.json.status<300)e.triggerHub("form:sendSuccess",t),e.trigger("sendSuccess",t),e.showFeedback(t.json.data.message||e.options.defaultSuccessMessage),e.options.removeFormOnSuccess&&(e.$form.parentNode.removeChild(e.$form),e.options.scroller&&window.setTimeout(function(){e.options.scroller.toElement(e.$feedback||e.node)},0));else{e.triggerHub("form:sendError",t),e.trigger("sendError",t);var s=e.options.findFieldErrors(t.json);s?(e.displayFieldErrors(s),t.json.message&&e.showFeedback(t.json.message,2)):e.showFeedback(t.json.message||e.options.defaultErrorMessage,2)}}).catch(function(t){throw e.isLoading=!1,e.node.classList.remove(e.options.classLoading),"abort"===t.type?(e.showFeedback(e.options.defaultAbortMessage,1),t):(e.showFeedback(e.options.defaultErrorMessage,2),t)})}}}}]),t}();n.defaultOptions={scroller:null,defaultSuccessMessage:"Nachricht wurde erfolgreich versendet!",defaultErrorMessage:"Beim Senden der Nachricht ist ein Fehler aufgetreten!",defaultAbortMessage:"Sie haben das Senden abgebrochen.",classLoading:"-loading",removeFormOnSuccess:!0,showProgress:!0,hideProgressOnEnd:!0,progressClassShow:"-show",formFieldClass:"form-field",formFieldClassError:"-error",formFieldMessageElement:"div",formFieldMessageClass:"message",feedbackClassSuccess:"-success",feedbackClassWarning:"-warning",feedbackClassError:"-error",tokenEndpoint:null,tokenFieldName:"_token",findFieldErrors:function(e){return e.errors},getErrorField:function(e){var t=e.id.replace("fields.",""),s=this.$form.querySelector('[name="fields['+t+']"]');return s?s.closest("."+this.options.formFieldClass):null},getFieldErrors:function(e){return e.messages}},t.default=n}])});
//# sourceMappingURL=main.min.js.map