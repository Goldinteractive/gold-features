{"version":3,"sources":["webpack://feature-map/webpack/universalModuleDefinition","webpack://feature-map/webpack/bootstrap","webpack://feature-map/./src/controls/geolocation.js","webpack://feature-map/external \"js-base\"","webpack://feature-map/./src/index.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__1__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","GeolocationControl","map","_this","this","position","arguments","length","undefined","callback","_classCallCheck","navigator","geolocation","google","maps","ControlPosition","RIGHT_BOTTOM","userLocation","getSavedUserLocation","$icon","document","createElement","className","$element","classList","toggle","appendChild","event","addDomListener","e","preventDefault","add","getUserLocation","success","error","remove","controls","push","style","display","location","sessionStorage","getItem","split","LatLng","parseFloat","cb","_this2","getCurrentPosition","coords","latitude","longitude","setItem","lat","lng","err","_jsBase","_geolocation","cachedStyles","cachedIcons","Map","features","Feature","isResizing","isDraging","markers","currentMarker","initialZoom","parseInt","node","getAttribute","options","mapOptions","zoom","initialCenter","center","bounds","LatLngBounds","infoWindow","InfoWindow","theme","styles","_loadMap","utils","fetch","json","assetLocation","then","catch","ex","console","innerHTML","clearInstanceListeners","_get","__proto__","getPrototypeOf","_this3","geolocationControl","_geolocation2","default","setCenter","geolocationControlZoom","setZoom","message","listenerFirstIdle","addDomListenerOnce","_firstIdleListener","listenerIdle","_idleListener","forEach","marker","addMarker","boundMarkers","addBoundMarker","listenerZoomChanged","_zoomChangedListener","listenerDragstart","_dragstartListener","listenerDragend","_dragendListener","listenerResize","addEventListener","_resizeListener","trigger","cachedIcon","markerOptions","iconUrl","_this4","assign","defaultMarkerOptions","pin","anchorPoint","icon","Promise","resolve","reject","_loadMarker","image","Image","onload","markerWidth","naturalWidth","markerHeight","naturalHeight","markerWidthScaled","scaleIcon","markerHeightScaled","Point","url","size","Size","scaledSize","anchor","origin","src","_this5","addBound","Marker","content","addListener","_markerClickListener","panTo","open","extend","fitBounds","updateCenter","responsive","resetOnResize","resetCenter","resetZoom","getCenter","pos","_this6","pan","_this7","one","setContent","close","getPosition","_this8","draging","_this9","_this10","_this11","_this12","fn","rAF","resize","bind","defaultOptions","paths","assets","disableDefaultUI","scrollwheel","zoomControl","mapTypeControl","draggable"],"mappings":"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","file":"lib/main.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"js-base\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"feature-map\", [\"js-base\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"feature-map\"] = factory(require(\"js-base\"));\n\telse\n\t\troot[\"feature-map\"] = factory(root[\"js-base\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__1__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","export default class GeolocationControl {\n\n  constructor(map, position = null, callback = null) {\n    if (!navigator.geolocation) return\n\n    position = position || google.maps.ControlPosition.RIGHT_BOTTOM\n\n    this.userLocation = this.getSavedUserLocation()\n    this.map = map\n\n    this.$icon = document.createElement('div')\n    this.$icon.className = 'geolocation-control-icon'\n\n    this.$element = document.createElement('div')\n    this.$element.className = 'geolocation-control'\n    this.$element.classList.toggle('-active', !!this.userLocation)\n\n    this.$element.appendChild(this.$icon)\n\n    google.maps.event.addDomListener(this.$element, 'click', (e) => {\n      e.preventDefault()\n      this.$element.classList.add('-pending')\n\n      this.getUserLocation((success, position, error) => {\n        this.$element.classList.remove('-pending')\n\n        if (success) {\n          this.$element.classList.add('-active')\n        }\n\n        if (callback) {\n          callback(success, position, error)\n        }\n      })\n    }, false)\n\n    this.map.controls[position].push(this.$element)\n  }\n\n  hide() {\n    this.$element.style.display = 'none'\n  }\n\n  show() {\n    this.$element.style.display = 'block'\n  }\n\n  getSavedUserLocation() {\n    var location = window.sessionStorage.getItem('gmap-user-location')\n    if (!location) return null\n\n    var position = location.split(',')\n\n    return new google.maps.LatLng(\n      parseFloat(position[0]),\n      parseFloat(position[1])\n    )\n  }\n\n  getUserLocation(cb) {\n    if (this.userLocation) {\n      cb(true, this.userLocation, null)\n      return true\n    }\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((geolocation) => {\n        let position = new google.maps.LatLng(\n          geolocation.coords.latitude, geolocation.coords.longitude\n        )\n\n        this.userLocation = position\n\n        window.sessionStorage.setItem(\n          'gmap-user-location', position.lat() +','+ position.lng()\n        )\n\n        cb(true, position)\n      }, (err) => {\n        cb(false, null, err)\n      })\n    } else {\n      cb(false, null, `Browser doesn't support geocoding`)\n    }\n  }\n\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","import { features } from '@goldinteractive/js-base'\nimport { utils, paths } from '@goldinteractive/js-base'\nimport GeolocationControl from './controls/geolocation'\n\nvar cachedStyles = {}\nvar cachedIcons = {}\n\nclass Map extends features.Feature {\n\n  init() {\n\n    this.isResizing = false\n    this.isDraging = false\n\n    this.markers = []\n    this.currentMarker = null\n\n    this.initialZoom = parseInt(this.node.getAttribute('data-zoom'), 10) || this.options.mapOptions.zoom\n    this.initialCenter = {\n      lat: parseFloat(this.node.getAttribute('data-lat')),\n      lng: parseFloat(this.node.getAttribute('data-lng'))\n    }\n\n    this.center = this.initialCenter\n    this.bounds = new google.maps.LatLngBounds()\n    this.infoWindow = new google.maps.InfoWindow()\n\n    this.options.mapOptions.zoom = this.initialZoom\n    this.options.mapOptions.center = this.initialCenter\n\n    var style = cachedStyles[this.options.theme] || null\n\n    if (!this.options.mapOptions.styles) {\n      if (!style) {\n        utils.fetch\n        .json(`${this.options.assetLocation}/styles/${this.options.theme}.json`)\n        .then((json) => {\n          // cache style\n          cachedStyles[this.options.theme] = json\n          // take styles for map and load it\n          this.options.mapOptions.styles = json\n          this._loadMap()\n        }).catch((ex) => {\n          console.error(`Loading map with theme \"${this.options.theme}\" failed`, ex)\n        })\n      } else {\n        this.options.mapOptions.styles = style\n      }\n    } else {\n      this._loadMap()\n    }\n  }\n\n  destroy() {\n    this.node.innerHTML = ''\n    google.maps.event.clearInstanceListeners(this.map)\n    this.map = null\n\n    super.destroy()\n  }\n\n  _loadMap() {\n    // create a map object and specify the DOM element for display.\n    this.map = new google.maps.Map(this.node, this.options.mapOptions)\n\n    if (this.options.geolocationControl) {\n      this.geolocationControl = new GeolocationControl(this.map, null, (success, position, error) => {\n        if (success) {\n          this.map.setCenter(position)\n          if (this.options.geolocationControlZoom) {\n            this.map.setZoom(this.options.geolocationControlZoom)\n          }\n        } else {\n          error = error.message || error\n          if (error != null) {\n            console.error(`Failed to detect user location: ${error}`)\n          } else {\n            console.error('Failed to detect user location')\n          }\n        }\n      })\n    }\n\n    this.listenerFirstIdle = google.maps.event.addDomListenerOnce(this.map, 'idle', this._firstIdleListener())\n    this.listenerIdle = google.maps.event.addDomListener(this.map, 'idle', this._idleListener())\n\n    this.options.markers.forEach((marker) => {\n      this.addMarker(marker)\n    })\n\n    this.options.boundMarkers.forEach((marker) => {\n      this.addBoundMarker(marker)\n    })\n\n    this.listenerZoomChanged = google.maps.event.addDomListener(this.map, 'zoom_changed', this._zoomChangedListener())\n    this.listenerDragstart = google.maps.event.addDomListener(this.map, 'dragstart', this._dragstartListener())\n    this.listenerDragend = google.maps.event.addDomListener(this.map, 'dragend', this._dragendListener())\n    this.listenerResize = this.addEventListener(window, 'resize', this._resizeListener())\n\n    this.trigger('loaded')\n  }\n\n\n  /**\n   * Adds a marker to the map with a optional info window.\n   *\n   * @param   {Object} options - The marker options.\n   * @returns {Promise} Resolves when marker has loaded.\n   */\n  addMarker(options = {}) {\n    var cachedIcon\n    var markerOptions\n    var iconUrl\n\n    // extend Google API marker options\n    markerOptions = Object.assign({}, Map.defaultMarkerOptions.markerOptions, options.markerOptions || {})\n\n    // extend marker options\n    options = Object.assign({}, Map.defaultMarkerOptions, options)\n\n    // set map the marker belongs to\n    markerOptions.map = this.map\n\n    // set position to map center position if no position given\n    markerOptions.position = markerOptions.position || this.initialCenter\n\n    // set full icon url\n    iconUrl = `${this.options.assetLocation}/pins/${options.pin}.png`\n\n    cachedIcon = cachedIcons[iconUrl] || null\n\n    if (cachedIcon) {\n      markerOptions.anchorPoint = cachedIcon.anchorPoint\n      markerOptions.icon = cachedIcon.icon\n\n      return new Promise((resolve, reject) => {\n        var marker = this._loadMarker(markerOptions, options)\n        resolve(marker)\n      })\n    }\n\n    return new Promise((resolve, reject) => {\n      var image = new Image()\n\n      image.onload = () => {\n        var markerWidth = image.naturalWidth\n        var markerHeight = image.naturalHeight\n        var markerWidthScaled = markerWidth * options.scaleIcon\n        var markerHeightScaled = markerHeight * options.scaleIcon\n\n        markerOptions.anchorPoint = new google.maps.Point(0, markerHeightScaled / -1)\n\n        markerOptions.icon = {}\n        markerOptions.icon.url = iconUrl\n        markerOptions.icon.size = new google.maps.Size(markerWidthScaled, markerHeightScaled)\n        markerOptions.icon.scaledSize = new google.maps.Size(markerWidthScaled, markerHeightScaled)\n        markerOptions.icon.anchor = new google.maps.Point(markerWidthScaled / 2, markerHeightScaled)\n        markerOptions.icon.origin = new google.maps.Point(0, 0)\n\n        // cache icon data\n        cachedIcons[iconUrl] = {\n          anchorPoint: markerOptions.anchorPoint,\n          icon: markerOptions.icon\n        }\n\n        var marker = this._loadMarker(markerOptions, options)\n        resolve(marker)\n      }\n\n      image.src = iconUrl\n    })\n  }\n\n  /**\n   * Adds a marker to the map with its position as boundary.\n   *\n   * @param   {Object} options - The marker options.\n   * @returns {Promise} Resolves when marker has loaded.\n   */\n  addBoundMarker(options = {}) {\n    var markerPromise = this.addMarker(options)\n    return markerPromise.then((marker) => {\n      this.addBound(marker.position)\n    })\n  }\n\n  _loadMarker(markerOptions, options) {\n    var marker = new google.maps.Marker(markerOptions)\n\n    if (options.content) {\n      google.maps.event.addListener(\n        marker, 'click', this._markerClickListener(marker, options.content, options.panTo, options.open)\n      )\n    }\n\n    this.markers.push(marker)\n    return marker\n  }\n\n  /**\n   * Adds a new boundary.\n   * @param {Object} position - The boundary position.\n   */\n  addBound(position) {\n    // extend bounds with new marker position\n    this.bounds.extend(position)\n    // fit map according to current bounds\n    this.map.fitBounds(this.bounds)\n    // update center position\n    this.updateCenter()\n  }\n\n  resize() {\n    // trigger resize\n    google.maps.event.trigger(this.map, 'resize')\n\n    if (this.options.responsive && !this.options.resetOnResize) {\n      // preserve the current center point\n      this.map.setCenter(this.center)\n    }\n\n    if (this.options.resetOnResize) {\n      this.resetCenter(true)\n      this.resetZoom()\n    }\n\n    this.isResizing = false\n    this.trigger('resized')\n  }\n\n  updateCenter() {\n    this.center = this.map.getCenter()\n  }\n\n  setInitialCenter(pos) {\n    this.map.setCenter(pos)\n    this.initialCenter = pos\n  }\n\n  setInitialZoom(zoom) {\n    this.map.setZoom(zoom)\n    this.initialZoom = zoom\n  }\n\n  zoomIn() {\n    this.map.setZoom(++this.map.zoom)\n  }\n\n  zoomOut() {\n    this.map.setZoom(--this.map.zoom)\n  }\n\n  resetCenter(pan = false) {\n    if (pan) {\n      this.map.panTo(this.initialCenter)\n    } else {\n      this.map.setCenter(this.initialCenter)\n    }\n  }\n\n  resetZoom() {\n    this.map.setZoom(this.initialZoom)\n  }\n\n  _firstIdleListener() {\n    return () => {\n      this.trigger('firstIdle')\n    }\n  }\n\n  _markerClickListener(marker, content, pan, open) {\n    if (open) {\n      this.one('firstIdle', () => {\n        this.currentMarker = marker\n        this.infoWindow.setContent(content)\n        this.infoWindow.open(this.map, marker)\n      })\n    }\n\n    return () => {\n      if (this.currentMarker != marker) {\n        this.currentMarker = marker\n        this.infoWindow.setContent(content)\n        this.infoWindow.open(this.map, marker)\n      } else {\n        this.currentMarker = null\n        this.infoWindow.close()\n      }\n\n      if (pan) {\n        var pos = marker.getPosition()\n        this.map.panTo(pos)\n        this.center = pos\n      }\n    }\n  }\n\n  _idleListener() {\n    return (e) => {\n      if (!this.draging) {\n        this.updateCenter()\n      }\n\n      this.trigger('idle')\n    }\n  }\n\n  _zoomChangedListener() {\n    return (e) => {\n      this.trigger('zoomChanged')\n    }\n  }\n\n  _dragstartListener() {\n    return (e) => {\n      this.isDraging = true\n      this.trigger('dragstart')\n    }\n  }\n\n  _dragendListener() {\n    return (e) => {\n      this.isDraging = false\n      this.trigger('dragend')\n    }\n  }\n\n  _resizeListener() {\n    return (e) => {\n      if (!this.isResizing) {\n        this.isResizing = true\n        utils.fn.rAF(this.resize.bind(this))\n      }\n    }\n  }\n\n}\n\n/**\n * Default feature options.\n *\n * @type {Object}\n * @property {String} theme='default'\n *   Style theme used for map.\n * @property {Boolean} responsive=false\n *   Recenters map on resize.\n * @property {Boolean} resetOnResize=false\n *   Resets map to initial zoom and center on resize.\n * @property {Boolean} geolocationControl=false\n *   Adds a geolocation control.\n * @property {Number|null} geolocationControlZoom=null\n *   Zoom applied after geolocation click.\n * @property {Object} mapOptions\n *   Google Map API options for map instance.\n */\nMap.defaultOptions = {\n  theme: 'default',\n  assetLocation: `${paths.assets}/features/map`,\n  markers: [],\n  boundMarkers: [],\n  responsive: true,\n  resetOnResize: false,\n  geolocationControl: false,\n  geolocationControlZoom: null,\n  mapOptions: {\n    zoom: 12,\n    disableDefaultUI: true,\n    scrollwheel: false,\n    zoomControl: true,\n    mapTypeControl: false\n  }\n}\n\nMap.defaultMarkerOptions = {\n  open: false,\n  content: null,\n  panTo: false,\n  scaleIcon: 0.5,\n  pin: 'default',\n  markerOptions: {\n    draggable: false\n  }\n}\n\nexport default Map\n"],"sourceRoot":""}