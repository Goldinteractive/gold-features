{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ffcbd56b12fd89bfa554","webpack:///./src/index.js","webpack:///external \"js-base\"","webpack:///./src/controls/geolocation.js"],"names":["root","factory","exports","module","require","define","amd","self","this","__WEBPACK_EXTERNAL_MODULE_1__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_jsBase","_geolocation","cachedStyles","cachedIcons","Map","features","Feature","_this2","isResizing","isDraging","markers","currentMarker","initialZoom","parseInt","node","getAttribute","options","mapOptions","zoom","initialCenter","lat","parseFloat","lng","center","bounds","google","maps","LatLngBounds","infoWindow","InfoWindow","style","theme","styles","_loadMap","utils","fetch","json","assetLocation","then","catch","ex","console","error","innerHTML","event","clearInstanceListeners","map","_get","__proto__","getPrototypeOf","_this3","geolocationControl","_geolocation2","default","success","position","setCenter","geolocationControlZoom","setZoom","message","listenerFirstIdle","addDomListenerOnce","_firstIdleListener","listenerIdle","addDomListener","_idleListener","forEach","marker","addMarker","boundMarkers","addBoundMarker","listenerZoomChanged","_zoomChangedListener","listenerDragstart","_dragstartListener","listenerDragend","_dragendListener","listenerResize","addEventListener","window","_resizeListener","cachedIcon","markerOptions","iconUrl","_this4","arguments","length","undefined","assign","defaultMarkerOptions","pin","anchorPoint","icon","Promise","resolve","reject","_loadMarker","image","Image","onload","markerWidth","naturalWidth","markerHeight","naturalHeight","markerWidthScaled","scaleIcon","markerHeightScaled","Point","url","size","Size","scaledSize","anchor","origin","src","_this5","addBound","Marker","content","addListener","_markerClickListener","panTo","open","push","extend","fitBounds","updateCenter","trigger","responsive","resetOnResize","resetCenter","resetZoom","getCenter","pos","_this6","pan","_this7","one","setContent","close","getPosition","_this8","e","draging","_this9","_this10","_this11","_this12","fn","rAF","resize","bind","defaultOptions","paths","assets","disableDefaultUI","scrollwheel","zoomControl","mapTypeControl","draggable","GeolocationControl","_this","callback","_classCallCheck","navigator","geolocation","ControlPosition","RIGHT_BOTTOM","userLocation","getSavedUserLocation","$icon","document","createElement","className","$element","classList","toggle","appendChild","preventDefault","add","getUserLocation","remove","controls","display","location","sessionStorage","getItem","split","LatLng","cb","getCurrentPosition","coords","latitude","longitude","setItem","err"],"mappings":"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","file":"lib/main.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"js-base\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"feature-map\", [\"js-base\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"feature-map\"] = factory(require(\"js-base\"));\n\telse\n\t\troot[\"feature-map\"] = factory(root[\"js-base\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ffcbd56b12fd89bfa554","import { features } from '@goldinteractive/js-base'\nimport { utils, paths } from '@goldinteractive/js-base'\nimport GeolocationControl from './controls/geolocation'\n\nvar cachedStyles = {}\nvar cachedIcons = {}\n\nclass Map extends features.Feature {\n\n  init() {\n\n    this.isResizing = false\n    this.isDraging = false\n\n    this.markers = []\n    this.currentMarker = null\n\n    this.initialZoom = parseInt(this.node.getAttribute('data-zoom'), 10) || this.options.mapOptions.zoom\n    this.initialCenter = {\n      lat: parseFloat(this.node.getAttribute('data-lat')),\n      lng: parseFloat(this.node.getAttribute('data-lng'))\n    }\n\n    this.center = this.initialCenter\n    this.bounds = new google.maps.LatLngBounds()\n    this.infoWindow = new google.maps.InfoWindow()\n\n    this.options.mapOptions.zoom = this.initialZoom\n    this.options.mapOptions.center = this.initialCenter\n\n    var style = cachedStyles[this.options.theme] || null\n\n    if (!this.options.mapOptions.styles) {\n      if (!style) {\n        utils.fetch\n        .json(`${this.options.assetLocation}/styles/${this.options.theme}.json`)\n        .then((json) => {\n          // cache style\n          cachedStyles[this.options.theme] = json\n          // take styles for map and load it\n          this.options.mapOptions.styles = json\n          this._loadMap()\n        }).catch((ex) => {\n          console.error(`Loading map with theme \"${this.options.theme}\" failed`, ex)\n        })\n      } else {\n        this.options.mapOptions.styles = style\n      }\n    } else {\n      this._loadMap()\n    }\n  }\n\n  destroy() {\n    this.node.innerHTML = ''\n    google.maps.event.clearInstanceListeners(this.map)\n    this.map = null\n\n    super.destroy()\n  }\n\n  _loadMap() {\n    // create a map object and specify the DOM element for display.\n    this.map = new google.maps.Map(this.node, this.options.mapOptions)\n\n    if (this.options.geolocationControl) {\n      this.geolocationControl = new GeolocationControl(this.map, null, (success, position, error) => {\n        if (success) {\n          this.map.setCenter(position)\n          if (this.options.geolocationControlZoom) {\n            this.map.setZoom(this.options.geolocationControlZoom)\n          }\n        } else {\n          error = error.message || error\n          if (error != null) {\n            console.error(`Failed to detect user location: ${error}`)\n          } else {\n            console.error('Failed to detect user location')\n          }\n        }\n      })\n    }\n\n    this.listenerFirstIdle = google.maps.event.addDomListenerOnce(this.map, 'idle', this._firstIdleListener())\n    this.listenerIdle = google.maps.event.addDomListener(this.map, 'idle', this._idleListener())\n\n    this.options.markers.forEach((marker) => {\n      this.addMarker(marker)\n    })\n\n    this.options.boundMarkers.forEach((marker) => {\n      this.addBoundMarker(marker)\n    })\n\n    this.listenerZoomChanged = google.maps.event.addDomListener(this.map, 'zoom_changed', this._zoomChangedListener())\n    this.listenerDragstart = google.maps.event.addDomListener(this.map, 'dragstart', this._dragstartListener())\n    this.listenerDragend = google.maps.event.addDomListener(this.map, 'dragend', this._dragendListener())\n    this.listenerResize = this.addEventListener(window, 'resize', this._resizeListener())\n  }\n\n\n  /**\n   * Adds a marker to the map with a optional info window.\n   *\n   * @param   {Object} options - The marker options.\n   * @returns {Promise} Resolves when marker has loaded.\n   */\n  addMarker(options = {}) {\n    var cachedIcon\n    var markerOptions\n    var iconUrl\n\n    // extend Google API marker options\n    markerOptions = Object.assign({}, Map.defaultMarkerOptions.markerOptions, options.markerOptions || {})\n\n    // extend marker options\n    options = Object.assign({}, Map.defaultMarkerOptions, options)\n\n    // set map the marker belongs to\n    markerOptions.map = this.map\n\n    // set position to map center position if no position given\n    markerOptions.position = markerOptions.position || this.initialCenter\n\n    // set full icon url\n    iconUrl = `${this.options.assetLocation}/pins/${options.pin}.png`\n\n    cachedIcon = cachedIcons[iconUrl] || null\n\n    if (cachedIcon) {\n      markerOptions.anchorPoint = cachedIcon.anchorPoint\n      markerOptions.icon = cachedIcon.icon\n\n      return new Promise((resolve, reject) => {\n        var marker = this._loadMarker(markerOptions, options)\n        resolve(marker)\n      })\n    }\n\n    return new Promise((resolve, reject) => {\n      var image = new Image()\n\n      image.onload = () => {\n        var markerWidth = image.naturalWidth\n        var markerHeight = image.naturalHeight\n        var markerWidthScaled = markerWidth * options.scaleIcon\n        var markerHeightScaled = markerHeight * options.scaleIcon\n\n        markerOptions.anchorPoint = new google.maps.Point(0, markerHeightScaled / -1)\n\n        markerOptions.icon = {}\n        markerOptions.icon.url = iconUrl\n        markerOptions.icon.size = new google.maps.Size(markerWidthScaled, markerHeightScaled)\n        markerOptions.icon.scaledSize = new google.maps.Size(markerWidthScaled, markerHeightScaled)\n        markerOptions.icon.anchor = new google.maps.Point(markerWidthScaled / 2, markerHeightScaled)\n        markerOptions.icon.origin = new google.maps.Point(0, 0)\n\n        // cache icon data\n        cachedIcons[iconUrl] = {\n          anchorPoint: markerOptions.anchorPoint,\n          icon: markerOptions.icon\n        }\n\n        var marker = this._loadMarker(markerOptions, options)\n        resolve(marker)\n      }\n\n      image.src = iconUrl\n    })\n  }\n\n  /**\n   * Adds a marker to the map with its position as boundary.\n   *\n   * @param   {Object} options - The marker options.\n   * @returns {Promise} Resolves when marker has loaded.\n   */\n  addBoundMarker(options = {}) {\n    var markerPromise = this.addMarker(options)\n    return markerPromise.then((marker) => {\n      this.addBound(marker.position)\n    })\n  }\n\n  _loadMarker(markerOptions, options) {\n    var marker = new google.maps.Marker(markerOptions)\n\n    if (options.content) {\n      google.maps.event.addListener(\n        marker, 'click', this._markerClickListener(marker, options.content, options.panTo, options.open)\n      )\n    }\n\n    this.markers.push(marker)\n    return marker\n  }\n\n  /**\n   * Adds a new boundary.\n   * @param {Object} position - The boundary position.\n   */\n  addBound(position) {\n    // extend bounds with new marker position\n    this.bounds.extend(position)\n    // fit map according to current bounds\n    this.map.fitBounds(this.bounds)\n    // update center position\n    this.updateCenter()\n  }\n\n  resize() {\n    // trigger resize\n    google.maps.event.trigger(this.map, 'resize')\n\n    if (this.options.responsive && !this.options.resetOnResize) {\n      // preserve the current center point\n      this.map.setCenter(this.center)\n    }\n\n    if (this.options.resetOnResize) {\n      this.resetCenter(true)\n      this.resetZoom()\n    }\n\n    this.isResizing = false\n    this.trigger('resized')\n  }\n\n  updateCenter() {\n    this.center = this.map.getCenter()\n  }\n\n  setInitialCenter(pos) {\n    this.map.setCenter(pos)\n    this.initialCenter = pos\n  }\n\n  setInitialZoom(zoom) {\n    this.map.setZoom(zoom)\n    this.initialZoom = zoom\n  }\n\n  zoomIn() {\n    this.map.setZoom(++this.map.zoom)\n  }\n\n  zoomOut() {\n    this.map.setZoom(--this.map.zoom)\n  }\n\n  resetCenter(pan = false) {\n    if (pan) {\n      this.map.panTo(this.initialCenter)\n    } else {\n      this.map.setCenter(this.initialCenter)\n    }\n  }\n\n  resetZoom() {\n    this.map.setZoom(this.initialZoom)\n  }\n\n  _firstIdleListener() {\n    return () => {\n      this.trigger('firstIdle')\n    }\n  }\n\n  _markerClickListener(marker, content, pan, open) {\n    if (open) {\n      this.one('firstIdle', () => {\n        this.currentMarker = marker\n        this.infoWindow.setContent(content)\n        this.infoWindow.open(this.map, marker)\n      })\n    }\n\n    return () => {\n      if (this.currentMarker != marker) {\n        this.currentMarker = marker\n        this.infoWindow.setContent(content)\n        this.infoWindow.open(this.map, marker)\n      } else {\n        this.currentMarker = null\n        this.infoWindow.close()\n      }\n\n      if (pan) {\n        var pos = marker.getPosition()\n        this.map.panTo(pos)\n        this.center = pos\n      }\n    }\n  }\n\n  _idleListener() {\n    return (e) => {\n      if (!this.draging) {\n        this.updateCenter()\n      }\n\n      this.trigger('idle')\n    }\n  }\n\n  _zoomChangedListener() {\n    return (e) => {\n      this.trigger('zoomChanged')\n    }\n  }\n\n  _dragstartListener() {\n    return (e) => {\n      this.isDraging = true\n      this.trigger('dragstart')\n    }\n  }\n\n  _dragendListener() {\n    return (e) => {\n      this.isDraging = false\n      this.trigger('dragend')\n    }\n  }\n\n  _resizeListener() {\n    return (e) => {\n      if (!this.isResizing) {\n        this.isResizing = true\n        utils.fn.rAF(this.resize.bind(this))\n      }\n    }\n  }\n\n}\n\n/**\n * Default feature options.\n *\n * @type {Object}\n * @property {String} theme='default'\n *   Style theme used for map.\n * @property {Boolean} responsive=false\n *   Recenters map on resize.\n * @property {Boolean} resetOnResize=false\n *   Resets map to initial zoom and center on resize.\n * @property {Boolean} geolocationControl=false\n *   Adds a geolocation control.\n * @property {Number|null} geolocationControlZoom=null\n *   Zoom applied after geolocation click.\n * @property {Object} mapOptions\n *   Google Map API options for map instance.\n */\nMap.defaultOptions = {\n  theme: 'default',\n  assetLocation: `${paths.assets}/features/map`,\n  markers: [],\n  boundMarkers: [],\n  responsive: true,\n  resetOnResize: false,\n  geolocationControl: false,\n  geolocationControlZoom: null,\n  mapOptions: {\n    zoom: 12,\n    disableDefaultUI: true,\n    scrollwheel: false,\n    zoomControl: true,\n    mapTypeControl: false\n  }\n}\n\nMap.defaultMarkerOptions = {\n  open: false,\n  content: null,\n  panTo: false,\n  scaleIcon: 0.5,\n  pin: 'default',\n  markerOptions: {\n    draggable: false\n  }\n}\n\nexport default Map\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-base\"\n// module id = 1\n// module chunks = 0","export default class GeolocationControl {\n\n  constructor(map, position = null, callback = null) {\n    if (!navigator.geolocation) return\n\n    position = position || google.maps.ControlPosition.RIGHT_BOTTOM\n\n    this.userLocation = this.getSavedUserLocation()\n    this.map = map\n\n    this.$icon = document.createElement('div')\n    this.$icon.className = 'geolocation-control-icon'\n\n    this.$element = document.createElement('div')\n    this.$element.className = 'geolocation-control'\n    this.$element.classList.toggle('-active', !!this.userLocation)\n\n    this.$element.appendChild(this.$icon)\n\n    google.maps.event.addDomListener(this.$element, 'click', (e) => {\n      e.preventDefault()\n      this.$element.classList.add('-pending')\n\n      this.getUserLocation((success, position, error) => {\n        this.$element.classList.remove('-pending')\n\n        if (success) {\n          this.$element.classList.add('-active')\n        }\n\n        if (callback) {\n          callback(success, position, error)\n        }\n      })\n    }, false)\n\n    this.map.controls[position].push(this.$element)\n  }\n\n  hide() {\n    this.$element.style.display = 'none'\n  }\n\n  show() {\n    this.$element.style.display = 'block'\n  }\n\n  getSavedUserLocation() {\n    var location = window.sessionStorage.getItem('gmap-user-location')\n    if (!location) return null\n\n    var position = location.split(',')\n\n    return new google.maps.LatLng(\n      parseFloat(position[0]),\n      parseFloat(position[1])\n    )\n  }\n\n  getUserLocation(cb) {\n    if (this.userLocation) {\n      cb(true, this.userLocation, null)\n      return true\n    }\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((geolocation) => {\n        let position = new google.maps.LatLng(\n          geolocation.coords.latitude, geolocation.coords.longitude\n        )\n\n        this.userLocation = position\n\n        window.sessionStorage.setItem(\n          'gmap-user-location', position.lat() +','+ position.lng()\n        )\n\n        cb(true, position)\n      }, (err) => {\n        cb(false, null, err)\n      })\n    } else {\n      cb(false, null, `Browser doesn't support geocoding`)\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controls/geolocation.js"],"sourceRoot":""}